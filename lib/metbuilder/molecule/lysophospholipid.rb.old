require_relative "./lipid_model"

class Lysophospholipid <  LipidModel

	def initialize(classe="lysophospholipid", abbrev, schain1, schain2)
		@classe="glycerolipid"
		@abbrev=abbrev
		@schain1=schain1
		@schain2=schain2
		@definition=String.new
		@smiles=String.new
		@total_chains=([@schain1,@schain2]-["0:0"]).length
		@total_chains_uniq=([@schain1,@schain2].uniq-["0:0"]).length
		@name=''
		@biofunction=[]
		@cellular_location=[]
		@metabolic_enzymes=[]
		@origin=[]
		@biofluid_location=[]
		@tissue_location=[]
		@pathways=[]
		@general_references=[]
		@transporters=[]
		@physiological_charge=0
		@charge=0
	end

	attr_reader :classe,:abbrev,:schain1,:schain2,:definition,:smiles,:name,:biofunction,:cellular_location,:metabolic_enzymes,:origin,:biofluid_location,:tissue_location,:pathways,:general_references,:transporters,:application,:physiological_charge,:charge
	attr_writer :abbrev,:schain1,:schain2,:definition,:smiles,:name,:biofunction,:cellular_location,:metabolic_enzymes,:origin,:biofluid_location,:tissue_location,:pathways,:general_references,:transporters,:application,:physiological_charge,:charge
		# builds a cardiolipin structure represented in SMILES format	
	def build_glycerophospholipid

		type=abbrev.split("(")[0]
		
		

		if type=="LysoPS"
			@classe="lysophosphatidylserine"
			head=$head_groups["LysoPS"][0]

		
		elsif type=="LysoPC"
			@classe="lysophosphatidylcholine"
			head=$head_groups['LysoPC'][0]

		
		elsif type=="LysoPE"
			@classe="lysophosphatidylethanolamine"
			head=$head_groups['LysoPE'][0]

		elsif type=="LysoPG"
			@classe="lysophosphatidylglycerol"
			head=$head_groups['LysoPG'][0]

		elsif type=="LysoPI"
			@classe="lysophosphatidylinositol"
			head=$head_groups['LysoPI'][0]
			
		

		elsif type=="LPA"
			@classe="lysophosphatidic acid"	
			head=$head_groups['LPA'][0]		
			
		
		else
			$stderr.puts "Unknown chain #{type}."
		end
		begin
			@smiles=head.gsub('R1',$chains[@schain1][1]).gsub('R2',$chains[@schain2][1]).gsub('()','')
		rescue
			if not $chains.keys.include?(@schain1)
				$stderr.puts "#{@schain1} not included"
			end
			if not $chains.keys.include?(@schain2)
				$stderr.puts "#{@schain2} not included"
			end
		end

	end

	# automatically generates a structural description for the given object
	def generate_definition

		st=Array.new
		
		if schain1!="0:0"
			if $chains[@schain1][0][0]!="(" and $chains[@schain1][0][-1]!=")"
				st<<"#{$chains[@schain1][0]}(R1)"
			elsif $chains[@schain1][0][0]=="(" and $chains[@schain1][0][-1]==")"
				st<<"#{$chains[@schain1][0][1...-1]}(R1)"
			end
		end

		if schain2!="0:0"
			if $chains[@schain2][0][0]!="(" and $chains[@schain2][0][-1]!=")"
				st<<"#{$chains[@schain2][0]}(R2)"
			elsif $chains[@schain2][0][0]=="(" and $chains[@schain2][0][-1]==")"
				st<<"#{$chains[@schain2][0][1...-1]}(R2)"
			end
		end		

		
       		
			if @classe=="lysophosphatidylethanolamine" #LysoPE
				@definition="#{@abbrev} is a lysophospholipid. The term 'lysophospholipid' (LPL) refers to any phospholipid that is missing one of its two O-acyl chains. Thus, LPLs have a free alcohol in either the sn-1 or sn-2 position. The prefix 'lyso-' comes from the fact that lysophospholipids were originally found to be hemolytic however it is now used to refer generally to phospholipids missing an acyl chain. LPLs are usually the result of phospholipase A-type enzymatic activity on regular phospholipids such as phosphatidylcholine or phosphatidic acid, although they can also be generated by the acylation of glycerophospholipids or the phosphorylation of monoacylglycerols. #{abbrev}, in particular, consists of one #{st[0].gsub('(R1)','').gsub('(R2)','')} chain  to the C-1 atom, and  one #{st[1].gsub('(R1)','').gsub('(R2)','')}  to the C-2 atom.. Some LPLs serve important signaling functions such as lysophosphatidic acid. Lysophosphatidylethanolamines (LPEs) can function as plant growth regulators with several diverse uses. (LPEs) are approved for outdoor agricultural use to accelerate ripening and improve the quality of fresh produce. "
			elsif @classe=="lysophosphatidylcholine" #LysoPC
				@definition="#{@abbrev} is a lysophospholipid (LyP). It is a monoglycerophospholipid in which a phosphorylcholine moiety occupies a glycerol substitution site. Lysophosphatidylcholines can have different combinations of fatty acids of varying lengths and saturation attached at the C-1 (sn-1) position. Fatty acids containing 16, 18 and 20 carbons are the most common.#{abbrev}, in particular, consists of one #{st[0].gsub('(R1)','').gsub('(R2)','')} chain  to the C-1 atom, and  one #{st[1].gsub('(R1)','').gsub('(R2)','')}  to the C-2 atom. The mead acid moiety is derived from fish oils, liver and kidney. Lysophosphatidylcholine is found in small amounts in most tissues. It is formed by hydrolysis of phosphatidylcholine by the enzyme phospholipase A2, as part of the de-acylation/re-acylation cycle that controls its overall molecular species composition. It can also be formed inadvertently during extraction of lipids from tissues if the phospholipase is activated by careless handling."
			elsif @classe=="lysophosphatidic acid" #LysoPA
				@definition="#{@abbrev}is a lysophosphatidic acid. It is a glycerophospholipid in which a phosphate moiety occupies a glycerol substitution site. Lysophosphatidic acids can have different combinations of fatty acids of varying lengths and saturation attached at the C-1 (sn-1) or C-2 (sn-2) position. Fatty acids containing 16 and 18 carbons are the most common.#{abbrev}, in particular, consists of one #{st[0].gsub('(R1)','').gsub('(R2)','')} chain  to the C-1 atom, and  one #{st[1].gsub('(R1)','').gsub('(R2)','')}  to the C-2 atom. Lysophosphatidic acid is the simplest possible glycerophospholipid. It is the biosynthetic precursor of phosphatidic acid. Although it is present at very low levels only in animal tissues, it is extremely important biologically, influencing many biochemical processes."
			elsif @classe=="lysophosphatidylserine" #LysoPS
				@definition="#{@abbrev}is a lysophospholipid. The term 'lysophospholipid' (LPL) refers to any phospholipid that is missing one of its two O-acyl chains. Thus, LPLs have a free alcohol in either the sn-1 or sn-2 position. The prefix 'lyso-' comes from the fact that lysophospholipids were originally found to be hemolytic however it is now used to refer generally to phospholipids missing an acyl chain. LPLs are usually the result of phospholipase A-type enzymatic activity on regular phospholipids such as phosphatidylcholine or phosphatidic acid, although they can also be generated by the acylation of glycerophospholipids or the phosphorylation of monoacylglycerols.#{abbrev}, in particular, consists of one #{st[0].gsub('(R1)','').gsub('(R2)','')} chain  to the C-1 atom, and  one #{st[1].gsub('(R1)','').gsub('(R2)','')}  to the C-2 atom. Some LPLs serve important signaling functions such as lysophosphatidic acid. Lysophosphatidylserines (LPSs) enhance glucose transport, lowering blood glucose levels while leaving secretion of insulin unaffected. LPSs have been known as a signaling phospholipid in mast cell biology. They enhance stimulated histamine release and eicosanoid production. LPSs also play a roles in the promotion of phagocytosis of apoptotic cells and resolution of inflammation."
			elsif @classe=="lysophosphatidylinositol" #LysoPI
				@definition="#{@abbrev}is a lysophospholipid. The term 'lysophospholipid' (LPL) refers to any phospholipid that is missing one of its two O-acyl chains. Thus, LPLs have a free alcohol in either the sn-1 or sn-2 position. The prefix 'lyso-' comes from the fact that lysophospholipids were originally found to be hemolytic however it is now used to refer generally to phospholipids missing an acyl chain. LPLs are usually the result of phospholipase A-type enzymatic activity on regular phospholipids such as phosphatidylcholine or phosphatidic acid, although they can also be generated by the acylation of glycerophospholipids or the phosphorylation of monoacylglycerols. #{abbrev}, in particular, consists of one #{st[0].gsub('(R1)','').gsub('(R2)','')} chain  to the C-1 atom, and  one #{st[1].gsub('(R1)','').gsub('(R2)','')}  to the C-2 atom. Some LPLs serve important signaling functions such as lysophosphatidic acid. Lysophosphatidylinositol is an endogenous lysophospholipid and endocannabinoid neurotransmitter."
			else
				@definition="#{@abbrev} belongs to the family of #{@classe}s. These are #{$lipid_class_definitions[@classe+"s"][0]} #{@abbrev} is also a substrate of CDP-diacylglycerol pyrophosphatase. It is involved in CDP-diacylglycerol degradation pathway."
			end
			
			 #@definition="#{@abbrev} belongs to the family of #{@classe}s, which are #{$lipid_class_definitions[@classe+"s"][0]} #{@abbrev} is made up of one #{st[0]}, and one #{st[1]}."
			
		

	end

	def annotate
		type=abbrev.split("(")[0]
		
		
		elsif type=="LysoPE"
			@biofunction=["Cell signaling"]
			@cellular_location=["Membrane"]
			@metabolic_enzymes=[]
			@origin=["Endogenous"]	
			@biofluid_location=[]
			@tissue_location=[]
			@pathways=[]
			@general_references=[]
			@transporters=[]
			@application=[]
			@physiological_charge=0
		elsif type=="LysoPC"
			@biofunction=["Cell signaling"]
			@cellular_location=["Membrane"]
			@metabolic_enzymes=[]
			@origin=["Endogenous"]	
			@biofluid_location=[]
			@tissue_location=[]
			@pathways=[]
			@general_references=[]
			@transporters=[]
			@application=[]
			@physiological_charge=0
		elsif type=="LPA"
			@biofunction=["Cell signaling"]
			@cellular_location=["Membrane"]
			@metabolic_enzymes=[]
			@origin=["Endogenous"]	
			@biofluid_location=[]
			@tissue_location=[]
			@pathways=[]
			@general_references=[]
			@transporters=[]
			@application=[]
			@physiological_charge=-2
		elsif type=="LysoPS"
			@biofunction=[]
			@cellular_location=["Membrane"]
			@metabolic_enzymes=[]
			@origin=["Endogenous"]	
			@biofluid_location=[]
			@tissue_location=[]
			@pathways=[]
			@general_references=[]
			@transporters=[]
			@application=[]
			@physiological_charge=0
		elsif type=="LysoPI"
			@biofunction=[]
			@cellular_location=["Membrane"]
			@metabolic_enzymes=[]
			@origin=["Endogenous"]	
			@biofluid_location=[]
			@tissue_location=[]
			@pathways=[]
			@general_references=[]
			@transporters=[]
			@application=[]
			@physiological_charge=0

		else
			$stderr.puts "Unknown chain #{type}."
		end
	end


	# automatically generates a systematic name for the given object
	def generate_name

		prefixes=Hash.new
		parts=Array.new
		l=0
		for k in [@schain1,@schain2]
			l=l+1
			if prefixes.keys.include?($chains[k][0])
				prefixes[$chains[k][0]]<<l
				#puts "Adding another for #{k} : #{l}"
			else
				prefixes[$chains[k][0]]=[l]
				#puts "Adding first for #{k} : #{l}"
			end
		end
		
		for a in prefixes.keys
			if a!=''
				#puts a, prefixes[a].sort.join(','),prefixes[a].length
				#puts $units_nr[prefixes[a].length.to_s]
				if a[0]!="("
					parts<<"#{prefixes[a].sort.join(',')}-#{$units_nr[prefixes[a].length.to_s]}#{a}"
					#puts "#{prefixes[a].sort.join(',')}-#{$units_nr[prefixes[a].length.to_s]}#{a}"
				elsif a[0]=="("  and prefixes[a].length==1
					parts<<"#{prefixes[a].sort.join(',')}-#{a}"
					#puts "#{prefixes[a].sort.join(',')}-#{$units_nr[prefixes[a].length.to_s]}-#{a}"
				elsif a[0]=="("  and prefixes[a].length!=1
					parts<<"#{prefixes[a].sort.join(',')}-#{$units_nr[prefixes[a].length.to_s]}-#{a}"
					#puts "#{prefixes[a].sort.join(',')}-#{$units_nr[prefixes[a].length.to_s]}#{a}"				
				end
				
			end
		end
		@name="#{parts.sort.join('-')}-#{$head_groups[@abbrev.split("(")[0]][3]}"
	end

	def synonyms
		@synonyms = @classe + "(" + @abbrev.split("(")[1] + "\n" + @name
	end

end
